<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Toronto Waste Search</title>
        <link rel="icon" href="/res/icon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/res/styles.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    </head>
    <body>
        <script>

            var searchKeyword = '';

            function analizeInput(text){
                if(text.length == 0){
                    document.getElementById("searchResult").innerHTML="";
                    console.log("input erased");
                }
                
                searchKeyword = text;
            }

            function requestData(url, cFunction) {
                var keyword = document.forms['input'].elements['search'].value;
                console.log(keyword);

                $.ajax({
                    type: 'POST',
                    url:url,
                    data:'search='+keyword,
                    success:function(data){generateSearchResult(data)},
                    error:function(jqXHR,textStatus, errorThrown){
                        alert("Error, status = " + textStatus + ", " +"error thrown: " + errorThrown);
                    },
                    //contentType: 'application/x-www-form-urlencoded; charset=UTF-8/',
                    
                });
                /*var xhttp;
                xhttp=new XMLHttpRequest();
                
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        cFunction(this);

                    }
                };
                xhttp.open('POST', url, true);
                xhttp.setRequestHeader('Content-type', 'application/json');
                xhttp.send({search:keyword});*/
                return false;
            }

            function generateSearchResult(data){
                var container = document.getElementById('searchResult');
                data.data.forEach(element => {
                    
                });
                console.log(data);
            }
            
        </script>

        <h1>Search Toronto Waste</h1>
        
        <form name="input" onSubmit="return requestData('/search',generateSearchResult);">
            <input type="text" placeholder="Search.." name="search" onchange="analizeInput(this.value)">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>

        <div id="searchResult">
        </div>
        
    </body>
</html>